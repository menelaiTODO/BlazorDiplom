@page "/main"
@using BlazorDiplom.Components.Main.FuzzyConstructor
@using BlazorDiplom.Components.Main.Shared
@using BlazorDiplom.ViewModels
@using DevExpress.Blazor.Popup;

@layout MainLayout

@inherits SalesCubeComponent
<CascadingAuthenticationState>
    <AuthorizeView>
        <Authorized>
            <h3 style="color: white;">Куб продаж</h3>
            <button @onclick="RunSalesEtlJob" type="button" class="btn btn-primary">Запуск ETL процесса</button>
            <button @onclick="CreateFuzzyQuery" type="button" class="btn btn-danger">Сформировать нечеткий запрос</button>
            @if (GridData == null)
            {
                <p><em>Loading...</em></p>
            }
            else
            {
                <DxChart Data="@GridData">
                    <DxChartLineSeries Name="Продажи"
                                       ArgumentField="@((OlapSales s) => s.MonthName)"
                                       ValueField="@((OlapSales s) => s.Sum)"
                                       DashStyle="ChartDashStyle.Dash">
                    </DxChartLineSeries>
                </DxChart>

                <DxDataGrid Data="@GridData">
                    <DxDataGridColumn Field="@nameof(OlapSales.MonthName)" Caption="Месяц"></DxDataGridColumn>
                    <DxDataGridColumn Field="@nameof(OlapSales.SalesCount)" Caption="Количество продаж"></DxDataGridColumn>
                    <DxDataGridColumn Field="@nameof(OlapSales.Sum)" Caption="Сумма продаж"></DxDataGridColumn>
                </DxDataGrid>
            }

            <DxPopup HeaderText="Конструктор нечеткого запроса" @bind-Visible=IsFuzzyQueryConstuctorVisible @onclose="() => IsFuzzyQueryConstuctorVisible = false" >
                <FuzzyConstructor></FuzzyConstructor>
            </DxPopup>

        </Authorized>
        <NotAuthorized>
            <p>Вы не авторизованы</p>
        </NotAuthorized>
    </AuthorizeView>
</CascadingAuthenticationState>

